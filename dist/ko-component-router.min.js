!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("knockout")):"function"==typeof define&&define.amd?define(["knockout"],t):"object"==typeof exports?exports["ko-component-router"]=t(require("knockout")):e["ko-component-router"]=t(e.ko)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=r(1),o=n(i),a=r(2),u=n(a);r(15),o.default.components.register("__KO_ROUTER_EMPTY_COMPONENT__",{template:"<span></span>"}),o.default.components.register("ko-component-router",{synchronous:!0,viewModel:u.default,template:"<div data-bind='if: ctx.route().component'>\n      <div class=\"component-wrapper\" data-bind='component: {\n        name: ctx.route().component,\n        params: ctx\n      }'></div>\n    </div>"})},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var r=t.element,n=f.default.contextFor(r);return new x(r,n,f.default.toJS(e))}function a(e){return e=e||window.event,null===e.which?e.button:e.which}function u(){}function l(e){var t=location.protocol+"//"+location.hostname;return location.port&&(t+=":"+location.port),e&&0===e.indexOf(t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(1),f=n(s),p=r(3),d=n(p),h=r(8),y=n(h),v=r(12),g=n(v),m=r(10),b=!(0,m.isUndefined)(document)&&document.ontouchstart?"touchstart":"click",x=function(){function e(t,r,n){var o=n.routes,a=n.base,l=void 0===a?"":a,c=n.hashbang,s=void 0!==c&&c,f=n.inTransition,p=void 0===f?u:f,h=n.outTransition,v=void 0===h?u:h,x=n.persistState,w=void 0!==x&&x,O=n.persistQuery,k=void 0!==O&&O,_=n.queryParser,P=void 0===_?d.default.parse:_,j=n.queryStringifier,$=void 0===j?d.default.stringify:j;i(this,e);for(var A in o)o[A]=new g.default(A,o[A]);this.config={el:t,base:l,hashbang:s,routes:o,inTransition:p,outTransition:v,persistState:w,persistQuery:k,queryParser:P,queryStringifier:$},this.ctx=new y.default(r,this.config);var C=(0,m.isUndefined)(this.ctx.$parent);this.onclick=this.onclick.bind(this),this.onpopstate=this.onpopstate.bind(this),document.addEventListener(b,this.onclick,!1),C&&window.addEventListener("popstate",this.onpopstate,!1);var E=!0;if(C||(E=this.ctx.$parent.path()!==this.ctx.$parent.canonicalPath()),E){var S=this.config.hashbang&&~location.hash.indexOf("#!")?location.hash.substr(2)+location.search:location.pathname+location.search+location.hash,R=!1,N=!1;C||(R=this.ctx.$parent._$childInitState,N=this.ctx.$parent._$childInitQuery,delete this.ctx.$parent._$childInitState,delete this.ctx.$parent._$childInitQuery),this.ctx._update(S,R,!1,N)}}return c(e,[{key:"onpopstate",value:function(e){if(!e.defaultPrevented){var t=location.pathname+location.search+location.hash,r=(e.state||{})[(0,m.normalizePath)(this.ctx.config.depth+this.ctx.pathname())];this.ctx._update(t,r,!1)&&e.preventDefault()}}},{key:"onclick",value:function(e){for(var t=e.target;t&&"A"!==t.nodeName;)t=t.parentNode;if(t&&"A"===t.nodeName){var r=1!==a(e),n=e.metaKey||e.ctrlKey||e.shiftKey,i=t.hasAttribute("download"),o=t.hasAttribute("target"),u="external"===t.getAttribute("rel"),c=~(t.getAttribute("href")||"").indexOf("mailto:"),s=!l(t.href),f="#"===t.getAttribute("href");if(!(s||r||i||f||c||u||n||o)){var p=t.pathname+t.search+(t.hash||"");this.ctx._update(p)&&e.preventDefault()}}}},{key:"dispose",value:function(){document.removeEventListener(b,this.onclick,!1),window.removeEventListener("popstate",this.onpopstate,!1),this.ctx.destroy()}}]),e}();t.default={createViewModel:o}},function(e,t,r){"use strict";var n=r(4),i=r(7),o=r(6);e.exports={formats:o,parse:i,stringify:n}},function(e,t,r){"use strict";var n=r(5),i=r(6),o={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Date.prototype.toISOString,u={delimiter:"&",encode:!0,encoder:n.encode,serializeDate:function(e){return a.call(e)},skipNulls:!1,strictNullHandling:!1},l=function e(t,r,i,o,a,u,l,c,s,f,p){var d=t;if("function"==typeof l)d=l(r,d);else if(d instanceof Date)d=f(d);else if(null===d){if(o)return u?u(r):r;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||n.isBuffer(d))return u?[p(u(r))+"="+p(u(d))]:[p(r)+"="+p(String(d))];var h=[];if("undefined"==typeof d)return h;var y;if(Array.isArray(l))y=l;else{var v=Object.keys(d);y=c?v.sort(c):v}for(var g=0;g<y.length;++g){var m=y[g];a&&null===d[m]||(h=Array.isArray(d)?h.concat(e(d[m],i(r,m),i,o,a,u,l,c,s,f,p)):h.concat(e(d[m],r+(s?"."+m:"["+m+"]"),i,o,a,u,l,c,s,f,p)))}return h};e.exports=function(e,t){var r=e,n=t||{},a="undefined"==typeof n.delimiter?u.delimiter:n.delimiter,c="boolean"==typeof n.strictNullHandling?n.strictNullHandling:u.strictNullHandling,s="boolean"==typeof n.skipNulls?n.skipNulls:u.skipNulls,f="boolean"==typeof n.encode?n.encode:u.encode,p=f?"function"==typeof n.encoder?n.encoder:u.encoder:null,d="function"==typeof n.sort?n.sort:null,h="undefined"!=typeof n.allowDots&&n.allowDots,y="function"==typeof n.serializeDate?n.serializeDate:u.serializeDate;if("undefined"==typeof n.format)n.format=i.default;else if(!Object.prototype.hasOwnProperty.call(i.formatters,n.format))throw new TypeError("Unknown format option provided.");var v,g,m=i.formatters[n.format];if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");"function"==typeof n.filter?(g=n.filter,r=g("",r)):Array.isArray(n.filter)&&(g=n.filter,v=g);var b=[];if("object"!=typeof r||null===r)return"";var x;x=n.arrayFormat in o?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var w=o[x];v||(v=Object.keys(r)),d&&v.sort(d);for(var O=0;O<v.length;++O){var k=v[O];s&&null===r[k]||(b=b.concat(l(r[k],k,w,c,s,p,g,d,h,y,m)))}return b.join(a)}},function(e,t){"use strict";var r=Object.prototype.hasOwnProperty,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();t.arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)"undefined"!=typeof e[n]&&(r[n]=e[n]);return r},t.merge=function(e,n,i){if(!n)return e;if("object"!=typeof n){if(Array.isArray(e))e.push(n);else{if("object"!=typeof e)return[e,n];e[n]=!0}return e}if("object"!=typeof e)return[e].concat(n);var o=e;return Array.isArray(e)&&!Array.isArray(n)&&(o=t.arrayToObject(e,i)),Array.isArray(e)&&Array.isArray(n)?(n.forEach(function(n,o){r.call(e,o)?e[o]&&"object"==typeof e[o]?e[o]=t.merge(e[o],n,i):e.push(n):e[o]=n}),e):Object.keys(n).reduce(function(e,r){var o=n[r];return Object.prototype.hasOwnProperty.call(e,r)?e[r]=t.merge(e[r],o,i):e[r]=o,e},o)},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",i=0;i<t.length;++i){var o=t.charCodeAt(i);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?r+=t.charAt(i):o<128?r+=n[o]:o<2048?r+=n[192|o>>6]+n[128|63&o]:o<55296||o>=57344?r+=n[224|o>>12]+n[128|o>>6&63]+n[128|63&o]:(i+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(i)),r+=n[240|o>>18]+n[128|o>>12&63]+n[128|o>>6&63]+n[128|63&o])}return r},t.compact=function(e,r){if("object"!=typeof e||null===e)return e;var n=r||[],i=n.indexOf(e);if(i!==-1)return n[i];if(n.push(e),Array.isArray(e)){for(var o=[],a=0;a<e.length;++a)e[a]&&"object"==typeof e[a]?o.push(t.compact(e[a],n)):"undefined"!=typeof e[a]&&o.push(e[a]);return o}var u=Object.keys(e);return u.forEach(function(r){e[r]=t.compact(e[r],n)}),e},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!==e&&"undefined"!=typeof e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}},function(e,t){"use strict";var r=String.prototype.replace,n=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return r.call(e,n,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,r){"use strict";var n=r(5),i=Object.prototype.hasOwnProperty,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:n.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},a=function(e,t){for(var r={},n=e.split(t.delimiter,t.parameterLimit===1/0?void 0:t.parameterLimit),o=0;o<n.length;++o){var a,u,l=n[o],c=l.indexOf("]=")===-1?l.indexOf("="):l.indexOf("]=")+1;c===-1?(a=t.decoder(l),u=t.strictNullHandling?null:""):(a=t.decoder(l.slice(0,c)),u=t.decoder(l.slice(c+1))),i.call(r,a)?r[a]=[].concat(r[a]).concat(u):r[a]=u}return r},u=function e(t,r,n){if(!t.length)return r;var i,o=t.shift();if("[]"===o)i=[],i=i.concat(e(t,r,n));else{i=n.plainObjects?Object.create(null):{};var a="["===o[0]&&"]"===o[o.length-1]?o.slice(1,o.length-1):o,u=parseInt(a,10);!isNaN(u)&&o!==a&&String(u)===a&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(i=[],i[u]=e(t,r,n)):i[a]=e(t,r,n)}return i},l=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^\.\[]+)/g,"[$1]"):e,o=/^([^\[\]]*)/,a=/(\[[^\[\]]*\])/g,l=o.exec(n),c=[];if(l[1]){if(!r.plainObjects&&i.call(Object.prototype,l[1])&&!r.allowPrototypes)return;c.push(l[1])}for(var s=0;null!==(l=a.exec(n))&&s<r.depth;)s+=1,(r.plainObjects||!i.call(Object.prototype,l[1].replace(/\[|\]/g,""))||r.allowPrototypes)&&c.push(l[1]);return l&&c.push("["+n.slice(l.index)+"]"),u(c,t,r)}};e.exports=function(e,t){var r=t||{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.delimiter="string"==typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:o.delimiter,r.depth="number"==typeof r.depth?r.depth:o.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:o.arrayLimit,r.parseArrays=r.parseArrays!==!1,r.decoder="function"==typeof r.decoder?r.decoder:o.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:o.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:o.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:o.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:o.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:o.strictNullHandling,""===e||null===e||"undefined"==typeof e)return r.plainObjects?Object.create(null):{};for(var i="string"==typeof e?a(e,r):e,u=r.plainObjects?Object.create(null):{},c=Object.keys(i),s=0;s<c.length;++s){var f=c[s],p=l(f,i[f],r);u=n.merge(u,p,r)}return n.compact(u)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(1),l=n(u),c=r(3),s=n(c),f=r(9),p=r(11),d=r(10),h=function(){function e(t,r){i(this,e),t.$router=this,this.bindingCtx=t;for(var n=t,o=!0;n.$parentContext;){if(n=n.$parentContext,n.$router){o=!1;break}n.$router=this}o?(l.default.router=this,l.default.router.history=l.default.observableArray([])):(this.$parent=n.$router,this.$parent.$child=this,r.base=this.$parent.pathname()),this.config=r,this.config.depth=e.getDepth(this),this.isNavigating=l.default.observable(!0),this.route=l.default.observable(""),this.canonicalPath=l.default.observable(""),this.path=l.default.observable(""),this.pathname=l.default.observable(""),this.hash=l.default.observable(""),this.params={},this.query=(0,f.factory)(this),this.state=(0,p.factory)(this),this._beforeNavigateCallbacks=[]}return a(e,[{key:"update",value:function(e,t,r){var n=this;return this._queuedArgs&&(arguments[2]=this._queuedArgs[2]||r),this._queuedArgs=arguments,this._queuedUpdate?this._queuedUpdate:this._queuedUpdate=new Promise(function(e){l.default.tasks.schedule(function(){n._update.apply(n,n._queuedArgs).then(e),n._queuedUpdate=!1})})}},{key:"_update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canonicalPath(),r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=this.resolveUrl(t),c=this.getRouteForUrl(u),f=""===this.route();if(!c){var p;return!!this.$parent&&(p=this.$parent).update.apply(p,arguments)}var h=this.toJS(),y=c.parse(u),v=o(y,6),g=v[0],m=v[1],b=v[2],x=v[3],w=v[4],O=v[5],k=this.pathname()===x,_=this.route()===c,P=function(){if(k){if(n.$child){var e=i;return i=!1,n.$child._update(O||"/",r,e,a).then(function(e){return r=!1,a=!1,!e})}return Promise.resolve(!0)}return n.runBeforeNavigateCallbacks()}();return P.then(function(t){if(!t)return Promise.resolve(!1);!a&&w&&(a=s.default.parse(w)[(0,d.normalizePath)(n.config.depth+x)]);var o=!(0,d.deepEquals)(m,n.prevParams),u=a&&!(0,d.deepEquals)(a,n.prevQuery),p=n.config._forceReloadOnParamChange&&o,y=n.config._forceReloadOnQueryChange&&u,v=p||y;n.prevParams=m,a&&(n.prevQuery=a),_&&!v||n.$child&&(n.$child.destroy(),delete n.$child),(!k&&!f||v)&&(n.isNavigating(!0),n.reload());var P=e.getCanonicalPath(n.getBase().replace(/\/$/,""),x,O,n.query.getFullQueryString(a,x),b),j={path:g,pathname:x,canonicalPath:P,hash:b,params:m,route:c};if(O&&!k?(j.state={},j.query={},n._$childInitState=r,n._$childInitQuery=a):(r===!1&&k?j.state=h.state:!n.config.persistState&&r&&(j.state=r),n.config.persistState&&(j.state=n.state())),!k||!(0,d.deepEquals)(h.query,j.query)){var $=""===P?n.getBase():P;i?l.default.router.history.push([history.state,$]):l.default.router.history.splice(l.default.router.history.length-1,1,[history.state,$]),history[i?"pushState":"replaceState"](history.state,document.title,$)}return new Promise(function(e){var t=function(t){var r=n.config.el.getElementsByClassName("component-wrapper")[0];delete j.query,j.route.runPipeline(j).then(function(){if(h.route.component===j.route.component){if((0,d.merge)(n,j),n.config._forceReloadOnParamChange&&o||n.config._forceReloadOnQueryChange&&u){var i=j.route;j.route={component:"__KO_ROUTER_EMPTY_COMPONENT__"},n.config._forceReloadOnParamChange=!1,n.config._forceReloadOnQueryChange=!1,l.default.tasks.runEarly(),n.route(i)}}else n.config._forceReloadOnParamChange=!1,n.config._forceReloadOnQueryChange=!1,(0,d.extend)(n,j);a&&n.query.update(a,x),n.isNavigating(!1),l.default.tasks.runEarly(),e(!0),t&&l.default.tasks.schedule(function(){return n.config.inTransition(r,h,j)})})};f||k?t(f):k||(n.config.outTransition(n.config.el,h,j,t),4!==n.config.outTransition.length&&t(!0))})})}},{key:"addBeforeNavigateCallback",value:function(e){this._beforeNavigateCallbacks.push(e)}},{key:"runBeforeNavigateCallbacks",value:function(){for(var e=this,t=[];e;)t=e._beforeNavigateCallbacks.concat(t),e=e.$child;return(0,d.cascade)(t)}},{key:"forceReloadOnParamChange",value:function(){this.config._forceReloadOnParamChange=!0}},{key:"forceReloadOnQueryChange",value:function(){this.config._forceReloadOnQueryChange=!0}},{key:"getRouteForUrl",value:function(e){var t=e.split("#")[0].split("?")[0],r=void 0,n=1/0;for(var i in this.config.routes){var o=this.config.routes[i];if(o.matches(t)){if(0===o._keys.length)return o;(n===1/0||o._keys.length<n&&".*"!==o._keys[0].pattern)&&(n=o._keys.length,r=o)}}return r}},{key:"destroy",value:function(){this.$child&&(this.$child.destroy(),delete this.$child),this.query.dispose(),this.state.dispose()}},{key:"reload",value:function(){this._beforeNavigateCallbacks=[],this.query.reload(),this.state.reload()}},{key:"resolveUrl",value:function(e){var t=(e+"").replace("/#!","");if(0===t.indexOf("./"))t=t.replace("./","/");else for(var r=this;r&&t.toLowerCase().indexOf(r.config.base.toLowerCase())>-1;)t=t.replace(new RegExp(r.config.base,"i"),""),r=r.$parent;return t}},{key:"toJS",value:function(){return l.default.toJS({route:this.route,path:this.path,pathname:this.pathname,canonicalPath:this.canonicalPath,hash:this.hash,state:this.state,params:this.params,query:this.query.getAll(!1,this.pathname())})}},{key:"getBase",value:function(){for(var e="",t=this;t;)e=t.config.base+(!t.config.hashbang||t.$parent?"":"/#!")+e,t=t.$parent;return e}}],[{key:"getCanonicalPath",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return""+e+t+r+(n?"?"+n:"")+(i?"#"+i:"")}},{key:"getDepth",value:function(e){for(var t=0;e.$parent;)e=e.$parent,t++;return t}}]),e}();t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return new h(e)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.factory=a;var l=r(1),c=n(l),s=r(10),f={},p=c.default.observable(!0),d={},h=function(){function e(t){if(o(this,e),this.ctx=t,!this.ctx.$parent){var r=window.location.href.indexOf("?");~r&&this.updateFromString(window.location.href.split("?")[1])}this.get=this.get.bind(this),this.clear=this.clear.bind(this),this.update=this.update.bind(this)}return u(e,[{key:"get",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.identity,n=this,o=this.ctx,a=(0,s.normalizePath)(o.config.depth+o.pathname());return d[a]||(d[a]={}),d[a][e]||(d[a][e]={parser:r,value:c.default.pureComputed({read:function(){return p(),f&&f[a]&&!(0,s.isUndefined)(f[a][e])?d[a][e].parser(f[a][e]):t},write:function(t){var r=location,u=r.pathname,l=r.hash;(0,s.deepEquals)(t,this.prev)||(this.prev=t,(0,s.merge)(f,i({},a,i({},e,t)),!1),o.update(u+l,o.state(),!1,n.getNonDefaultParams()[a]).then(function(){return p(!p())}))},owner:{prev:null}})}),t&&(d[a][e].defaultVal=(0,s.clone)(t),f&&f[a]&&(0,s.isUndefined)(f[a][e])&&this.get(e)(t)),d[a][e].value}},{key:"getAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.ctx.pathname(),r=(0,s.normalizePath)(this.ctx.config.depth+t);return e?c.default.pureComputed({read:function(){return p(),this.getAll()},write:function(e){for(var t in e)this.get(t)(e[t])}},this):c.default.toJS((0,s.mapKeys)(f[r]||{},function(e){return d[r]&&d[r][e]?(0,s.isUndefined)(f[r][e])?void 0:d[r][e].parser(f[r][e]):f[r][e]}))}},{key:"setDefaults",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.identity;for(var r in e)this.get(r,e[r],t)}},{key:"clear",value:function(e){"string"!=typeof e&&(e=this.ctx.pathname());var t=(0,s.normalizePath)(this.ctx.config.depth+e);for(var r in d[t]){var n=d[t][r];this.get(r)(n.defaultVal)}}},{key:"reload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.normalizePath)(this.ctx.config.depth+this.ctx.pathname());if(!this.ctx.config.persistQuery||e){for(var r in f[t])d[t]&&d[t][r]&&d[t][r].value.dispose();delete f[t],delete d[t]}p(!p())}},{key:"dispose",value:function(){for(var e in f)0===e.indexOf(this.ctx.config.depth)&&this.reload(!0,e)}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.ctx.pathname(),r=(0,s.normalizePath)(this.ctx.config.depth+t);(0,s.deepEquals)(f[r],e)||((0,s.merge)(f,i({},r,e),!1),p(!p()))}},{key:"updateFromString",value:function(e,t){if(t){var r=(0,s.normalizePath)(this.ctx.config.depth+t);(0,s.merge)(f,i({},r,this.parse(e)[r]),!1)}else(0,s.merge)(f,this.parse(e),!1);p(!p())}},{key:"getNonDefaultParams",value:function(e,t){var r={},n=f;e&&(0,s.merge)(n,i({},(0,s.normalizePath)(this.ctx.config.depth+t),e),!1);for(var o in n)if(d[o]){r[o]={};for(var a in n[o]){var u=n[o][a],l=d[o][a],c=l&&l.defaultVal;(0,s.isUndefined)(u)||(0,s.deepEquals)(u,c)||(r[o][a]=u)}}else r[o]=n[o];return r}},{key:"getFullQueryString",value:function(e,t){return this.stringify(this.getNonDefaultParams(e,t))}},{key:"parse",value:function(e){var t=c.default.router.config.queryParser;return t(e)}},{key:"stringify",value:function(e){var t=c.default.router.config.queryStringifier;return t(e)}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return Array.isArray(e)?e:Array.from(e)}function o(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return new Promise(function(t){if(0===e.length)return t(!0);var n=i(e),a=n[0],u=n.slice(1),l=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?o.apply(void 0,[u].concat(r)).then(t):t(!1)};if(a.length===r.length+1)a.apply(void 0,r.concat([l]));else{var c=a.apply(void 0,r);f(c)||"function"!=typeof c.then?l(c):c.then(l)}})}function a(e){return h(e)?e.slice(0):d(e)?c({},e,!1):e}function u(e){return"string"!=typeof e?e:decodeURIComponent(e.replace(/\+/g," "))}function l(e,t){if(null===e||null===t)return null===e&&null===t;if(("undefined"==typeof e?"undefined":x(e))!==("undefined"==typeof t?"undefined":x(t)))return!1;if(f(e))return f(t);if(b(e)&&b(t))return e===t;if(e.constructor===Object&&t.constructor===Object){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;var i=!0,o=!1,a=void 0;try{for(var u,c=r[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var s=u.value;if(!l(e[s],t[s]))return!1}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return!0}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;var p=!0,d=!1,h=void 0;try{for(var y,v=e[Symbol.iterator]();!(p=(y=v.next()).done);p=!0){var g=y.value;if(t.indexOf(g)<0)return!1}}catch(e){d=!0,h=e}finally{try{!p&&v.return&&v.return()}finally{if(d)throw h}}return!0}return e===t}function c(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Object.keys(t),o=!0,a=!1,u=void 0;try{for(var s,p=i[Symbol.iterator]();!(o=(s=p.next()).done);o=!0){var y=s.value;f(e[y])?e[y]=r?m(t[y]):t[y]:O.default.isWritableObservable(e[y])?l(e[y](),t[y])||e[y](t[y]):f(t[y])?e[y]=void 0:d(t[y])?(n&&(e[y]={}),c(e[y],t[y],r)):h(t[y])?e[y]=t[y].slice(0):e[y]=t[y]}}catch(e){a=!0,u=e}finally{try{!o&&p.return&&p.return()}finally{if(a)throw u}}return e}function s(e){return e}function f(e){return"undefined"==typeof e}function p(e){return"function"==typeof e}function d(e){return e.constructor===Object}function h(e){return p(e.splice)}function y(e,t){var r={};return Object.keys(e).forEach(function(e){return r[e]=t(e)}),r}function v(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c(e,t,r,!1)}function g(e){return 0===e.length?"/":("/"!==e[0]&&(e="".concat("/",e)),"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),e)}function m(e,t){var r=void 0;if(b(e))r=t?e:O.default.observable(e);else if(e instanceof Array){r=[];for(var n=0;n<e.length;n++)r[n]=m(e[n],!0);r=O.default.observableArray(r)}else if(e.constructor===Object){r={};for(var i in e)r[i]=m(e[i])}return r}function b(e){return null===e||void 0===e||e.constructor===String||e.constructor===Number||e.constructor===Boolean||e instanceof Date}Object.defineProperty(t,"__esModule",{value:!0});var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.cascade=o,t.clone=a,t.decodeURLEncodedURIComponent=u,t.deepEquals=l,t.extend=c,t.identity=s,t.isUndefined=f,t.isFunction=p,t.isPlainObject=d,t.isArray=h,t.mapKeys=y,t.merge=v,t.normalizePath=g;var w=r(1),O=n(w)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=a.default.observable(!1),r=a.default.pureComputed({read:function(){var r=(0,u.normalizePath)(e.config.depth+e.pathname());return t(),history.state?history.state[r]:{}},write:function(r){if(r=a.default.toJS(r)){var n=history.state||{},i=(0,u.normalizePath)(e.config.depth+e.pathname());(0,u.deepEquals)(r,history.state?history.state[i]:{})||(n[i]&&delete n[i],n[i]=r,history.replaceState(n,document.title),t(!t()))}}}),n=r.dispose;return r.reload=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.normalizePath)(e.config.depth+e.pathname());if((!e.config.persistState||t)&&history.state&&history.state[r]){var n=history.state;delete n[r]}},r.dispose=function(){for(var t in history.state)0===t.indexOf(e.config.depth)&&r.reload(!0,t);n.apply(r,arguments)},r}Object.defineProperty(t,"__esModule",{value:!0}),t.factory=i;var o=r(1),a=n(o),u=r(10)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(13),l=n(u),c=r(10),s=function(){function e(t,r){i(this,e),t="!"===t[t.length-1]?t.replace("!",":child_path(.*)?"):t.replace(/\(?\*\)?/,"(.*)"),"string"==typeof r?(this.component=r,this.pipeline=[]):"string"==typeof r[r.length-1]?(this.component=r.pop(),this.pipeline=r):this.pipeline=r,this._keys=[],this._regexp=(0,l.default)(t,this._keys)}return a(e,[{key:"matches",value:function(e){var t=e.indexOf("?");return~t&&(e=e.split("?")[0]),this._regexp.exec(decodeURIComponent(e))}},{key:"parse",value:function(e){var t=void 0,r="",n={},i=e.indexOf("#");if(~i){var a=e.split("#");e=a[0],r=(0,c.decodeURLEncodedURIComponent)(a[1])}for(var u=e.indexOf("?"),l=~u?e.split("?"):[e],s=o(l,2),f=s[0],p=s[1],d=this._regexp.exec(decodeURIComponent(f)),h=1,y=d.length;h<y;++h){var v=this._keys[h-1],g=(0,c.decodeURLEncodedURIComponent)(d[h]);!(0,c.isUndefined)(g)&&hasOwnProperty.call(n,v.name)||("child_path"===v.name?(0,c.isUndefined)(g)||(t="/"+g,e=e.substring(0,e.lastIndexOf(t)),f=f.substring(0,f.lastIndexOf(t))):n[v.name]=g)}return[e,n,r,f,p,t]}},{key:"runPipeline",value:function(e){return(0,c.cascade)(this.pipeline,e)}}]),e}();t.default=s},function(e,t,r){function n(e,t){for(var r,n=[],i=0,o=0,a="",u=t&&t.delimiter||"/";null!=(r=m.exec(e));){var s=r[0],f=r[1],p=r.index;if(a+=e.slice(o,p),o=p+s.length,f)a+=f[1];else{var d=e[o],h=r[2],y=r[3],v=r[4],g=r[5],b=r[6],x=r[7];a&&(n.push(a),a="");var w=null!=h&&null!=d&&d!==h,O="+"===b||"*"===b,k="?"===b||"*"===b,_=r[2]||u,P=v||g;n.push({name:y||i++,prefix:h||"",delimiter:_,optional:k,repeat:O,partial:w,asterisk:!!x,pattern:P?c(P):x?".*":"[^"+l(_)+"]+?"})}}return o<e.length&&(a+=e.substr(o)),a&&n.push(a),n}function i(e,t){return u(n(e,t))}function o(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function a(e){return encodeURI(e).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function u(e){for(var t=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(r,n){for(var i="",u=r||{},l=n||{},c=l.pretty?o:encodeURIComponent,s=0;s<e.length;s++){var f=e[s];if("string"!=typeof f){var p,d=u[f.name];if(null==d){if(f.optional){f.partial&&(i+=f.prefix);continue}throw new TypeError('Expected "'+f.name+'" to be defined')}if(g(d)){if(!f.repeat)throw new TypeError('Expected "'+f.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(f.optional)continue;throw new TypeError('Expected "'+f.name+'" to not be empty')}for(var h=0;h<d.length;h++){if(p=c(d[h]),!t[s].test(p))throw new TypeError('Expected all "'+f.name+'" to match "'+f.pattern+'", but received `'+JSON.stringify(p)+"`");i+=(0===h?f.prefix:f.delimiter)+p}}else{if(p=f.asterisk?a(d):c(d),!t[s].test(p))throw new TypeError('Expected "'+f.name+'" to match "'+f.pattern+'", but received "'+p+'"');i+=f.prefix+p}}else i+=f}return i}}function l(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function c(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function s(e,t){return e.keys=t,e}function f(e){return e.sensitive?"":"i"}function p(e,t){var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return s(e,t)}function d(e,t,r){for(var n=[],i=0;i<e.length;i++)n.push(v(e[i],t,r).source);var o=new RegExp("(?:"+n.join("|")+")",f(r));return s(o,t)}function h(e,t,r){return y(n(e,r),t,r)}function y(e,t,r){g(t)||(r=t||r,t=[]),r=r||{};for(var n=r.strict,i=r.end!==!1,o="",a=e[e.length-1],u="string"==typeof a&&/\/$/.test(a),c=0;c<e.length;c++){var p=e[c];if("string"==typeof p)o+=l(p);else{var d=l(p.prefix),h="(?:"+p.pattern+")";t.push(p),p.repeat&&(h+="(?:"+d+h+")*"),h=p.optional?p.partial?d+"("+h+")?":"(?:"+d+"("+h+"))?":d+"("+h+")",o+=h}}return n||(o=(u?o.slice(0,-2):o)+"(?:\\/(?=$))?"),o+=i?"$":n&&u?"":"(?=\\/|$)",s(new RegExp("^"+o,f(r)),t)}function v(e,t,r){return g(t)||(r=t||r,t=[]),r=r||{},e instanceof RegExp?p(e,t):g(e)?d(e,t,r):h(e,t,r)}var g=r(14);e.exports=v,e.exports.parse=n,e.exports.compile=i,e.exports.tokensToFunction=u,e.exports.tokensToRegExp=y;var m=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){for(var n=u(e,t),i=f(n,2),o=i[0],a=i[1],l=r?"?"+y.default.stringify(d.default.toJS(r)):"";o.$parent;)a=o.config.base+a,o=o.$parent;return o?o.config.base+(!o.config.hashbang||o.$parent?"":"/#!")+a+l:"#"}function o(e,t,r){var n=!!t.has("path")&&t.get("path"),o=!!t.has("query")&&t.get("query"),l=!!t.has("state")&&t.get("state"),c={};e.href="#",c.click=function(t,i){var a=1!==s(i),c=e.hasAttribute("target"),p="external"===e.getAttribute("rel"),h=i.metaKey||i.ctrlKey||i.shiftKey;if(a||c||p||h)return!0;
var y=u(r,n),v=f(y,2),g=v[0],m=v[1],b=g._update(m,d.default.toJS(l),!0,d.default.toJS(o),!0);return b?(i.preventDefault(),i.stopImmediatePropagation()):g.$parent||console.error("[ko-component-router] "+n+" did not match any routes!"),!b},c.attr={href:d.default.pureComputed(function(){return i(r,t.get("path"),o)})},n&&(c.css={"active-path":d.default.pureComputed(function(){return a(r,n)})}),d.default.tasks.schedule(function(){return d.default.applyBindingsToNode(e,c)})}function a(e,t){var r=u(e,t),n=f(r,2),i=n[0],o=n[1];if(c(i,o)){for(;i.$child;)if(i=i.$child,o=o.replace(i.config.base,"")||"/",!c(i,o))return!1;return!0}return!!i.$parent&&a(i.bindingCtx.$parentContext,o)}function u(e,t){var r=l(e),n=t?d.default.unwrap(t):r.canonicalPath();if(0===n.indexOf("//"))for(n=n.replace("//","/");r.$parent;)r=r.$parent;else for(;n&&n.match(/\/?\.\./i)&&r.$parent;)r=r.$parent,n=n.replace(/\/?\.\./i,"");return[r,n]}function l(e){for(;!(0,v.isUndefined)(e);){if(!(0,v.isUndefined)(e.$router))return e.$router;e=e.$parentContext}}function c(e,t){return(e.pathname()||"/")==="/"+t.split("/")[1]}function s(e){return e=e||window.event,null===e.which?e.button:e.which}Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.resolveHref=i;var p=r(1),d=n(p),h=r(3),y=n(h),v=r(10);d.default.bindingHandlers.path={init:function(e,t,r,n,i){o.call(this,e,r,i)}},d.default.bindingHandlers.state={init:function(e,t,r,n,i){o.call(this,e,r,i)}},d.default.bindingHandlers.query={init:function(e,t,r,n,i){o.call(this,e,r,i)}},d.default.bindingHandlers.path.utils={resolveHref:i}}])});